(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{16:function(t,n,r){"use strict";var e={$loaded:Promise.resolve(),clientsMeta:[],globalSettings:{muted:[]},chatSettings:{},notifications:!1,audioNotifications:!0},a=localStorage.getItem("dchat");a&&(a=JSON.parse(a),e.clientsMeta=a?[a]:[]);var c,u=localStorage.getItem("dchatv2");u&&((e=JSON.parse(u)).$loaded=Promise.resolve()),c=Proxy?new Proxy(e,{set:function(t,n,r){return"$loaded"!==n&&(t[n]=r,localStorage.setItem("dchatv2",JSON.stringify(t))),!0}}):e,n.a=c},167:function(t,n,r){"use strict";r.d(n,"b",(function(){return h})),r.d(n,"a",(function(){return v}));var e=r(3),a=r.n(e),c=r(9),u=r.n(c),o=r(80),i=r.n(o),s=r(21),f=r(119),d=r.n(f),p=r(120),l=r.n(p);function h(t){var n=i()(t),r=l()(t);return t=t.slice(t.indexOf(",")+1),t=d()(t,r),s.a.attachments.add({hash:n,data:t}).catch((function(){})),n}function v(t){return b.apply(this,arguments)}function b(){return(b=u()(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",s.a.attachments.get({hash:n}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},2:function(t,n,r){"use strict";r.d(n,"w",(function(){return s})),r.d(n,"v",(function(){return f})),r.d(n,"k",(function(){return d})),r.d(n,"e",(function(){return p})),r.d(n,"g",(function(){return l})),r.d(n,"i",(function(){return h})),r.d(n,"h",(function(){return v})),r.d(n,"y",(function(){return b})),r.d(n,"d",(function(){return g})),r.d(n,"f",(function(){return w})),r.d(n,"m",(function(){return y})),r.d(n,"l",(function(){return O})),r.d(n,"o",(function(){return m})),r.d(n,"s",(function(){return x})),r.d(n,"r",(function(){return j})),r.d(n,"q",(function(){return S})),r.d(n,"a",(function(){return D})),r.d(n,"b",(function(){return k})),r.d(n,"p",(function(){return A})),r.d(n,"x",(function(){return P})),r.d(n,"c",(function(){return N})),r.d(n,"j",(function(){return E})),r.d(n,"t",(function(){return T})),r.d(n,"u",(function(){return I})),r.d(n,"n",(function(){return R}));var e,a=r(18),c=r.n(a),u=r(80),o=r.n(u),i=r(60),s=function(t){return!!(null===t||void 0===t?void 0:t.startsWith("/whisper/"))},f=function(t){return s(t.topic)},d=function(t){return s(t)?t.slice("/whisper/".length):t};function p(t){return t?t.startsWith("dchat")&&45===t.length?t:"dchat"+o()(t):null}function l(t){return t?s(t)?d(t):t:""}function h(t){if(!t)throw new Error("No topic: "+t);return s(t)?y(t):"/chat/"+t}function v(t){return t||null}var b=function(t){if(!t)return["",""];var n=t.lastIndexOf("."),r=t,e="";return-1!==n&&(e=t.substring(0,n),r=t.slice(n+1)),[e,r]},g=function(t){if(!t)return!1;var n=b(t),r=c()(n,2),e=r[0],a=r[1];return e||a.slice(0,8)},w=function(t){var n=b(t),r=c()(n,2)[1];return i.Wallet.publicKeyToAddress(r)};function y(t){var n=d(t);return"/whisper/".concat(n)}function O(t){return y(t)}var m=function(t){return new Promise((function(n,r){var e=new FileReader;e.onload=function(t){n(t.target.result)},e.onerror=r,e.readAsText(t)}))},x=function(t){return t&&["event:subscribe","dchat/subscribe"].includes(t.contentType)},j=function(t){return t&&["event:message/delete","message/delete"].includes(t.contentType)},S=function(t){return t&&["contact"].includes(t.contentType)},D="__dchat",k=!1,A=function(t){return"\u2714"===(null===t||void 0===t?void 0:t.content)},P=function(t){return"@"+g(t)},N=!1===(null===(e=location)||void 0===e?void 0:e.href.includes("popup.html"));function E(t){var n=(t=t.replace(/^#/,"")).slice(0,t.indexOf("/",t.indexOf("/")+1)+1),r=t.slice(n.length);try{r=decodeURIComponent(r)}catch(e){}switch(n){case"/chat/":return r;case"/whisper/":return O(r)}}function T(t){return!s(t)&&(64===(t=t.slice(t.lastIndexOf(".")+1)).length&&t)}function I(t){return!s(t)}var R=function(){var t=Date.now();return 968971+Math.floor((t-1583501622400)/22006.1)}},21:function(t,n,r){"use strict";r.d(n,"b",(function(){return c})),r.d(n,"c",(function(){return u}));var e=r(123),a=new e.a("dchat");a.version(1).stores({attachments:"++id,&hash"}),a.version(2).stores({messages:"[topic+id+addr], [topic+createdAt], createdAt",reactions:"[topic+id+addr], [topic+targetID]"}),a.version(3).stores({contacts:"addr"});var c=e.a.maxKey,u=e.a.minKey;n.a=a},296:function(t,n,r){"use strict";r.d(n,"a",(function(){return a}));var e=new Audio("img/when.ogg");e.volume=.2;var a=function(){e.play()}},315:function(t,n,r){"use strict";r.r(n);var e,a=r(3),c=r.n(a),u=r(9),o=r.n(u),i=r(56),s=r(297),f=r(299),d=r(57),p=r(177),l=function(t){if(localStorage.getItem("dchat")){var n=JSON.parse(localStorage.getItem("dchat"));t.dispatch(Object(d.a)(n))}else var r,e=t.subscribe((function(){var n;if(r!==(r=null===(n=t.getState().clients[0])||void 0===n?void 0:n.addr)){var a=t.getState().clients[0];localStorage.setItem("dchat",JSON.stringify(a)),e()}}))},h=r(300),v=r.n(h),b=r(301),g=r(302),w=r(16),y=r(10),O=r(118),m=r.n(O),x=r(303),j=r(311),S=r(306),D=r(307),k=r(2),A=r(308),P=new Worker("dchat-nkn-worker-injector.js"),N=v()(P);if(k.b&&(e=localStorage.getItem("credentials")))try{e=JSON.parse(e)}catch(T){e=void 0}var E=w.a.$loaded.then(o()(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={clients:w.a.clientsMeta,chatSettings:w.a.chatSettings,globalSettings:w.a.globalSettings},r=Object(i.createStore)(b.a,n,Object(s.composeWithDevTools)(Object(i.applyMiddleware)(N,Object(p.alias)(g.a),S.a,A.a,j.a,x.a,D.a,f.a))),l(r),k.b&&e&&m.a.decrypt("d-chat!!!",e).then((function(t){var n=r.getState().clients.find((function(t){return t.active})),e=null===n||void 0===n?void 0:n.wallet.Address;e&&r.dispatch(Object(y.h)(t,e))})),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)}))));n.default=E},4:function(t,n,r){"use strict";r.d(n,"a",(function(){return d})),r.d(n,"f",(function(){return p})),r.d(n,"b",(function(){return l})),r.d(n,"c",(function(){return h})),r.d(n,"d",(function(){return v})),r.d(n,"e",(function(){return b}));var e=r(3),a=r.n(e),c=r(9),u=r.n(c),o=r(296),i=r(305),s=r.n(i),f=r(16);function d(t){return t}var p=function(){},l=s()((function(t){if(f.a.audioNotifications&&Object(o.a)(),f.a.notifications&&t.message)return new Notification(t.title||"D-Chat",{body:t.message||"",icon:"/img/NKN_DCHAT-128-128-border16.png"})}),250,{trailing:!1}),h=function(){return""},v=function(){},b=function(){var t=u()(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Notification){t.next=2;break}throw new Error("No Notifications");case 2:return t.next=4,Notification.requestPermission();case 4:if("granted"!==t.sent){t.next=9;break}return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},46:function(t,n,r){"use strict";r.d(n,"c",(function(){return O})),r.d(n,"a",(function(){return x})),r.d(n,"b",(function(){return S}));var e=r(3),a=r.n(e),c=r(7),u=r.n(c),o=r(34),i=r.n(o),s=r(9),f=r.n(s),d=r(80),p=r.n(d),l=r(21),h=r(119),v=r.n(h),b=r(120),g=r.n(b);function w(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.push.apply(r,e)}return r}function y(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?w(Object(r),!0).forEach((function(n){u()(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))}))}return t}function O(t){return m.apply(this,arguments)}function m(){return(m=f()(a.a.mark((function t(n){var r,e,c,u,o,s,f,d,h;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.addr){t.next=2;break}return t.abrupt("return");case 2:return r=n.addr,e=n.content,c=i()(n,["addr","content"]),o=(u=e||{}).avatar,s=i()(u,["avatar"]),"base64"===(null===o||void 0===o?void 0:o.type)&&(o.data&&"string"===typeof o.data?(f=o.data,d=g()(f),f=f.slice(f.indexOf(",")+1),f=v()(f,d),o.data=f,o.type="blob"):(o.data=null,o.type=null)),h=y(y({},c),{},{addr:r,content:y(y({},s),{},{avatar:o}),version:n.version||p()(e||Math.random().toString()),expiresAt:Date.now()+6048e5}),t.abrupt("return",l.a.contacts.put(h));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t){return j.apply(this,arguments)}function j(){return(j=f()(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",l.a.contacts.get(n).catch((function(t){return console.error("D-CHAT: getContact error:",t)})));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t){return D.apply(this,arguments)}function D(){return(D=f()(a.a.mark((function t(n){var r,e,c,u;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(n);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0={};case 5:return c=t.t0,t.next=8,k(null===c||void 0===c||null===(r=c.content)||void 0===r||null===(e=r.avatar)||void 0===e?void 0:e.data);case 8:if(t.t1=t.sent,t.t1){t.next=11;break}t.t1="";case 11:return u=t.t1,t.abrupt("return",y(y({},c),{},{content:y(y({},c.content),{},{avatar:{type:"base64",data:u}})}));case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t){return t?new Promise((function(n,r){var e=new FileReader;e.onload=function(){n(e.result)},e.onerror=r,e.readAsDataURL(t)})):""}},58:function(t,n,r){"use strict";r.d(n,"a",(function(){return p})),r.d(n,"c",(function(){return l})),r.d(n,"b",(function(){return h})),r.d(n,"e",(function(){return b})),r.d(n,"d",(function(){return w}));var e=r(7),a=r.n(e),c=r(3),u=r.n(c),o=r(9),i=r.n(o),s=r(21);function f(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.push.apply(r,e)}return r}function d(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?f(Object(r),!0).forEach((function(n){a()(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))}))}return t}var p=25;function l(t){var n=t.topic,r=t.previous,e=void 0===r?{}:r,a=t.extra,c=void 0===a?0:a,u=e.createdAt||s.b;return s.a.messages.where("[topic+createdAt]").between([n,s.c],[n,u],!1,!1).reverse().limit(p+c).sortBy("createdAt").then((function(t){return t.reverse()}))}function h(t){return v.apply(this,arguments)}function v(){return(v=i()(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",s.a.messages.get(j(n)));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(t){return g.apply(this,arguments)}function g(){return(g=i()(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("reaction"!==n.contentType){t.next=4;break}return t.abrupt("return",O(n));case 4:return t.abrupt("return",m(n));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t,n){return y.apply(this,arguments)}function y(){return(y=i()(u.a.mark((function t(n,r){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(n);case 2:if(!(e=t.sent)){t.next=6;break}return n=d(d({},e),r),t.abrupt("return",s.a.messages.put(n).then((function(){return n})).catch((function(t){return console.error("D-CHAT: HUGE RED FLAG, DB STORAGE",t)})));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(t){return s.a.reactions.put(t).catch((function(t){return console.error("D-CHAT: HUGE RED FLAG, DB STORAGE",t)}))}function m(t){return x.apply(this,arguments)}function x(){return(x=i()(u.a.mark((function t(n){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(n);case 2:return(r=t.sent)&&(n.createdAt=r.createdAt),t.abrupt("return",s.a.messages.put(n).then((function(){return n})).catch((function(t){return console.error("D-CHAT: HUGE RED FLAG, DB STORAGE",t)})));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function j(t){return{topic:t.topic,id:t.id,addr:t.addr}}},604:function(t,n,r){"use strict";r.d(n,"a",(function(){return a}));var e=r(21);function a(t){var n=t.topic,r=t.targetID;return e.a.reactions.where({topic:n,targetID:r}).toArray()}},656:function(t,n,r){}}]);