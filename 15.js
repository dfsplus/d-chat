(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{180:function(e,t,a){"use strict";var n=a(62),r=Object(n.b)();t.a=r},310:function(e,t,a){"use strict";var n=a(1),r=a.n(n),c=a(45),i=a(2),s=a(119),l=a(312);t.a=function(e){var t=e.topic,a=e.children,n=e.textWrapClassName,o=void 0===n?"":n,u=e.className,d=void 0===u?"":u,m=e.activeClassName,p=void 0===m?"is-active":m,b=e.avatarClassName,f=void 0===b?"is-32x32":b;return r.a.createElement(c.c,{to:Object(i.i)(t),className:d,activeClassName:p,isActive:function(){return Object(i.j)(location.hash)===t},draggable:!1},r.a.createElement("span",{className:"".concat(o," is-flex x-topic-link-text-wrap")},Object(i.w)(t)?r.a.createElement(l.a,{addr:Object(i.k)(t),className:f}):Object(i.t)(t)?r.a.createElement("span",{className:"icon x-topic-icon"},r.a.createElement(s.g,null)):r.a.createElement("span",{className:"icon x-topic-icon"},r.a.createElement(s.d,null)),r.a.createElement("span",{className:"x-topic-name"},Object(i.g)(t)),a))}},312:function(e,t,a){"use strict";var n=a(1),r=a.n(n),c=a(17),i=a.n(c),s=a(46),l=function(e){return Object(s.a)(e).then((function(e){var t,a;return null===e||void 0===e||null===(t=e.content)||void 0===t||null===(a=t.avatar)||void 0===a?void 0:a.data})).then((function(e){return e instanceof Blob?URL.createObjectURL(e):void 0}))},o=function(e){var t=Object(n.useState)(null),a=i()(t,2),r=a[0],c=a[1],s=Object(n.useCallback)((function(){l(e).then(c)}),[e]);return Object(n.useEffect)((function(){if(e){var t=!0;return l(e).then((function(e){return t&&c(e)})),function(){t=!1,r&&URL.revokeObjectURL(r)}}}),[]),{avatar:r,refresh:s}},u=a(22);t.a=Object(u.b)((function(e){return{contactEventAddr:e.contactEvent.addr}}))((function(e){var t=e.addr,a=e.className,c=void 0===a?"is-32x32":a,i=e.contactEventAddr,s=o(t),l=s.avatar,u=s.refresh;Object(n.useEffect)((function(){i===t&&u()}),[i,t]);var d=l||"img/no-photo.png";return r.a.createElement("img",{src:d,className:"x-avatar-image image ".concat(c)})}))},583:function(e,t,a){"use strict";var n=a(179),r=a.n(n),c=a(34),i=a.n(c),s=a(1),l=a.n(s),o=["className","title","id"];t.a=function(e){var t=e.className,a=e.title,n=void 0===a?"":a,c=e.id,s=void 0===c?Math.random():c,u=i()(e,o);return l.a.createElement(l.a.Fragment,null,l.a.createElement("input",r()({type:"checkbox",className:"switch ".concat(t),id:s},u)),l.a.createElement("label",{title:n,htmlFor:s}))}},604:function(e,t,a){"use strict";var n=a(9),r=a.n(n),c=a(3),i=a.n(c),s=a(311),l=a(1),o=a.n(l),u=a(115),d=a.n(u),m=a(45),p=a(31),b=a(22),f=a(587),v=a.n(f),h=Object(b.b)((function(e){var t,a;return{authStatus:null!=(null===(t=e.login)||void 0===t?void 0:t.addr)&&(null===(a=e.login)||void 0===a?void 0:a.connected)}}))((function(e){var t=e.path,a=e.component,n=e.authStatus;return o.a.createElement(v.a,{path:t,redirectPath:"/login",component:a,loggedIn:!!n})})),g=a(7),E=a.n(g),O=a(17),j=a.n(O),N=a(38),y=a.n(N),x=a(85),w=a.n(x),k=a(95),C=a.n(k),S=a(57),R=a.n(S),P=a(63),A=a.n(P),D=a(26),M=a.n(D),T=a(19),I=a.n(T),_=a(4),U=a(2),L=function(e){var t=e.white,a=e.black;return t?o.a.createElement("img",{src:"img/white-animatedlogo-fixed.gif"}):a?o.a.createElement("img",{src:"img/black-animatedlogo.gif"}):o.a.createElement("img",{src:"img/trans-animatedlogo.gif"})},W=function(e){var t=e.loading,a=e.children;return t?o.a.createElement("div",{className:"hero"},o.a.createElement("div",{className:"hero-body"},o.a.createElement("div",{className:"columns is-centered"},o.a.createElement("div",{className:"column is-half",style:{marginTop:"1rem"}},o.a.createElement("div",{className:"notification is-white"},o.a.createElement("figure",{className:"image container is-64x64"},o.a.createElement(L,{trans:!0})),o.a.createElement("p",{className:"subtitle has-text-centered"},Object(_.a)("Connecting to the blockchain...")),U.b&&o.a.createElement("div",{className:"field"},o.a.createElement("button",{className:"button is-text",type:"button",onClick:function(){return Object(_.d)()}},Object(_.a)("Reload")))))))):a},z=function(e){var t=e.white,a=e.blue;return o.a.createElement(o.a.Fragment,null,t?o.a.createElement("img",{src:"img/NKN_D-chat_white-64cropped.png"}):a?o.a.createElement("img",{src:"img/NKN_D-chat_blue-64cropped.png"}):o.a.createElement("img",{src:"img/logo-blue-border.png"}))},F=a(10),B=a(55),q=a(58);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=M()(e);if(t){var r=M()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return A()(this,a)}}var H=function(e){var t=e.err;return o.a.createElement(o.a.Fragment,null,t&&(t.includes("seed")?Object(_.a)("Invalid seed."):Object(_.a)("Wrong password.")))},V=function(e){R()(a,e);var t=K(a);function a(e){var n,r;y()(this,a),r=t.call(this,e);var c=Object(U.y)(e.activeClient.addr),i=j()(c,1)[0];return r.state={loading:!1,username:i||"",password:"",rememberMe:!1,showSeedPrompt:!1,seed:"",address:(null===(n=e.activeClient.wallet)||void 0===n?void 0:n.Address)||"",showError:!0,error:"",importedWallet:""},r.handleChange=r.handleChange.bind(C()(r)),r.handleCheckboxChange=r.handleCheckboxChange.bind(C()(r)),r.handleLoginSubmit=r.handleLoginSubmit.bind(C()(r)),r.handleAccountSwitch=r.handleAccountSwitch.bind(C()(r)),r.handleKeyStoreUpload=r.handleKeyStoreUpload.bind(C()(r)),r}return w()(a,[{key:"handleKeyStoreUpload",value:function(){var e=r()(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),null!==(a=t.target.files)&&void 0!==a&&a.length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Object(U.o)(t.target.files[0]);case 5:n=e.sent,this.setState({importedWallet:n});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e){var t;this.setState((t={},E()(t,e.target.name,e.target.value),E()(t,"showError",!1),E()(t,"error",""),t))}},{key:"handleCheckboxChange",value:function(e){var t;this.setState((t={},E()(t,e.target.name,e.target.checked),E()(t,"showError",!1),E()(t,"error",""),t))}},{key:"handleLoginSubmit",value:function(e){null===e||void 0===e||e.preventDefault();var t=this.state.seed;if(this.state.importedWallet)try{t=q.Wallet.fromJSON(this.state.importedWallet,{password:this.state.password}).getSeed()}catch(e){return this.setState({error:"Wrong password.",showError:!0}),void this.flashError()}this.props.dispatch(Object(F.h)({username:this.state.username,password:this.state.password,rememberMe:this.state.rememberMe},this.state.address,t)),this.setState({loading:!0,showError:this.state.error!==this.props.error}),this.flashError()}},{key:"flashError",value:function(){var e=this;clearTimeout(this.timeout),clearTimeout(this.timeout2),this.timeout=setTimeout((function(){return e.setState({showError:!1})}),1e3),this.timeout2=setTimeout((function(){return e.setState({error:""})}),2e3)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timeout),clearTimeout(this.timeout2)}},{key:"handleAccountSwitch",value:function(e){var t=e.target.value;if("seed"===t?this.setState({showSeedPrompt:!0}):this.setState({showSeedPrompt:!1}),"new"===t||"seed"===t)this.props.dispatch(Object(B.c)()),this.setState({address:"",username:""});else{var a=this.props.clients.find((function(e){return e.wallet.Address===t})),n=Object(U.y)(a.addr),r=j()(n,1)[0];this.setState({address:t,username:r})}}},{key:"componentDidUpdate",value:function(e,t){if(this.props.error!==e.error||this.state.error!==t.error&&this.state.error){var a=this.props.error||this.state.error;this.setState({error:a,loading:!1})}}},{key:"render",value:function(){var e,t,a,n=this.props,r=n.activeClient,c=n.clients,i=n.connecting,s=n.location,l=n.loggedIn,u=this.state.error,d=(null===s||void 0===s?void 0:s.search)&&(null===(e=new URL("http://example.org/".concat(s.search)))||void 0===e||null===(t=e.searchParams)||void 0===t?void 0:t.get("returnUrl"));return o.a.createElement("div",{className:"is-overlay x-is-login-overlay"},l?o.a.createElement(W,{loading:i},o.a.createElement(p.Redirect,{to:{pathname:d||"/"}})):o.a.createElement("div",{className:"hero is-primary is-overlay"},o.a.createElement("div",{className:"hero-body has-background-primary"},o.a.createElement("h1",{className:"title has-text-centered is-size-2"},Object(_.a)("Welcome!")),o.a.createElement("div",{className:"columns is-centered"},o.a.createElement("div",{className:"column is-9 is-4-desktop"},o.a.createElement("div",{className:"notification is-light"},o.a.createElement("figure",{className:"image container is-64x64"},o.a.createElement(z,null)),o.a.createElement("p",{className:"subtitle has-text-grey has-text-centered"},Object(_.a)("The decentralized chat awaits.")),o.a.createElement("form",{className:"",onSubmit:this.handleLoginSubmit},o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},Object(_.a)("Log in as")),o.a.createElement("div",{className:"control level"},o.a.createElement("span",{className:"select"},o.a.createElement("select",{name:"client",id:"client",defaultValue:(null===(a=r.wallet)||void 0===a?void 0:a.Address)||"new",onChange:this.handleAccountSwitch},o.a.createElement("option",{value:"new"},"-- ",Object(_.a)("New wallet")," --"),c.map((function(e){return o.a.createElement("option",{key:e.wallet.Address,value:e.wallet.Address},e.addr)})),o.a.createElement("option",{value:"seed"},"-- ",Object(_.a)("Import wallet")," --"))))),this.state.showSeedPrompt&&o.a.createElement("fieldset",{className:"box is-shadowless x-bordered has-background-light"},o.a.createElement("legend",null,Object(_.a)("Seed or key store")),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},Object(_.a)("Wallet seed")),o.a.createElement("div",{className:"control"},o.a.createElement("input",{className:"input",type:"password",disabled:!!this.state.importedWallet,onChange:this.handleChange,placeholder:Object(_.a)("Quite a long string"),name:"seed",autoComplete:"off",value:this.state.seed}))),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},Object(_.a)("Key store")),o.a.createElement("div",{className:"control"},o.a.createElement("input",{type:"file",disabled:!!this.state.seed,className:"input file",onChange:this.handleKeyStoreUpload})))),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},Object(_.a)("Nickname")),o.a.createElement("div",{className:"control"},o.a.createElement("input",{type:"username",name:"username",value:this.state.username,onChange:this.handleChange,className:"input",placeholder:"McAfee",autoComplete:"current-user",maxLength:"63"}))),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},Object(_.a)("Password"),o.a.createElement("span",{className:I()("help is-danger is-inline x-visibility",{"x-is-transparent":!this.state.showError})}," ",o.a.createElement(H,{err:u}))),o.a.createElement("div",{className:"control"},o.a.createElement("input",{type:"password",name:"password",value:this.state.password,onChange:this.handleChange,className:"input password",placeholder:"Password",autoComplete:"current-password"}))),U.b&&o.a.createElement("div",{className:"field"},o.a.createElement("div",{className:"control"},o.a.createElement("label",{className:"checkbox"},o.a.createElement("input",{type:"checkbox",checked:this.state.rememberMe,onChange:this.handleCheckboxChange,value:"rememberMe",name:"rememberMe",id:"rememberMe"}),Object(_.a)("Store password")))),o.a.createElement("div",{className:"field"},o.a.createElement("div",{className:"control"},o.a.createElement("button",{type:"submit",className:I()("button is-link",{"is-loading":this.state.loading})},Object(_.a)("Continue")))))))))))}}]),a}(o.a.Component),J=Object(b.b)((function(e){var t,a,n;return{loggedIn:null!=(null===(t=e.login)||void 0===t?void 0:t.addr),connecting:!(null!==(a=e.login)&&void 0!==a&&a.connected),error:null===(n=e.login)||void 0===n?void 0:n.error,clients:e.clients,activeClient:e.clients.find((function(e){return e.active}))||{}}}))(V),Y=a(310),Q=function(e){var t,a,n=e.hide,r=e.chat;return!r.hidden&&o.a.createElement("li",{title:Object(U.g)(r.topic)},o.a.createElement("span",{className:"delete is-medium",onClick:function(e){e.preventDefault(),n(r.topic)}}),o.a.createElement(Y.a,{topic:r.topic,className:I()("x-topic-link is-clearfix x-truncate",{"has-text-grey":r.muted}),activeClassName:"is-active",avatarClassName:"is-24x24"},o.a.createElement("span",{className:I()("x-unread-count",{"x-is-delayed":!(null===(t=r.unread)||void 0===t||!t.length)})},(null===(a=r.unread)||void 0===a?void 0:a.length)>0?r.unread.length:"")))},G=function(e,t){var a,n,r=e.lastMessage||1,c=t.lastMessage||1;if(!r)return 1;if(!c)return-1;if(e.muted&&!t.muted)return 1;if(!e.muted&&t.muted)return-1;var i,s=r-c>0?-1:1;return(null===(a=e.unread)||void 0===a?void 0:a.length)>0?(null===(i=t.unread)||void 0===i?void 0:i.length)>0?s:-1:(null===(n=t.unread)||void 0===n?void 0:n.length)>0?1:s},X=Object(b.b)((function(e){var t=[],a=[];for(var n in e.chatSettings)if(!e.chatSettings[n].hidden){var r=e.chatSettings[n],c={topic:n,unread:r.unread,lastMessage:r.receivedAt,muted:r.muted};Object(U.w)(n)?a.push(c):n!==U.a&&t.push(c)}return t.sort(G),a.sort(G),{topics:t,whispers:a}}),(function(e){return{hide:function(t){return e(Object(F.r)(t))}}}))((function(e){var t=e.hide,a=e.topics,n=e.whispers,r=e.labelClassName,c=void 0===r?"":r,i=e.wrapperClassName,s=void 0===i?"":i;return o.a.createElement(o.a.Fragment,{key:"topics-list"},o.a.createElement("div",{className:"x-topics-list x-topics-list-public ".concat(s)},o.a.createElement("p",{className:c},Object(_.a)("Channels")),o.a.createElement("ul",{className:"menu-list"},a.map((function(e){return o.a.createElement(Q,{key:e.topic,chat:e,hide:t})})))),o.a.createElement("div",{className:"x-topics-list x-topics-list-private ".concat(s)},o.a.createElement("p",{className:c},Object(_.a)("Whispers")),o.a.createElement("ul",{className:"menu-list"},n.map((function(e){return o.a.createElement(Q,{key:e.topic,chat:e,hide:t})})))))})),Z=function(){return null},$=function(){return o.a.createElement("aside",{className:"menu x-sidebar"},o.a.createElement("ul",{className:"menu-list"},o.a.createElement("li",null,o.a.createElement(m.b,{to:"/"},Object(_.a)("Home"))),o.a.createElement("li",null,o.a.createElement(m.b,{to:"/topics"},Object(_.a)("Public"))),o.a.createElement("li",null,o.a.createElement(m.b,{to:"/options"},Object(_.a)("Options")))),o.a.createElement(X,{labelClassName:"menu-label",wrapperClassName:"x-has-margin-top-bottom"}),o.a.createElement(Z,null))},ee=a(180),te=function(e){var t=e.className,a=e.children,n=void 0===a?"":a,r=Object(l.useRef)();return o.a.createElement("div",{onWheel:function(e){r.current.scrollLeft+=3*e.deltaY},ref:r,className:"x-horizontal-scroll ".concat(t)},n)};function ae(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ne(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(a),!0).forEach((function(t){E()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ae(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var re=function(e){var t,a=e.removeActiveTopic,n=e.isActive,r=e.topic,c=Object(l.useRef)();return Object(l.useLayoutEffect)((function(){var e;n&&(null===(e=c.current)||void 0===e||e.scrollIntoView({inline:"center"}))}),[n]),o.a.createElement("li",{ref:c,key:r._id,title:Object(U.g)(r._id),className:"x-topic-tab"},o.a.createElement(Y.a,{topic:r._id,className:I()("x-topic-link",{"x-has-unread":null===(t=r.unread)||void 0===t?void 0:t.length}),textWrapClassName:"x-is-fullwidth x-truncate x-truncate-limited-width x-topic-link-wrap"},o.a.createElement("span",{className:"delete",onClick:a})))},ce=Object(b.b)((function(e){return{topics:e.activeTopics.map((function(t){return ne(ne({},e.chatSettings[t]),{},{_id:t})})),currentTopic:Object(U.j)(location.hash)}}),(function(e){return{removeActiveTopic:function(t){return e(Object(F.q)(t))}}}))((function(e){var t=e.topics,a=e.removeActiveTopic,n=e.currentTopic;return o.a.createElement("ul",{className:"x-active-topics"},t.map((function(e){return o.a.createElement(re,{key:e._id,isActive:e._id===n,topic:e,removeActiveTopic:function(t){t.preventDefault(),a(e._id)}})})),o.a.createElement("li",{className:"x-topic-tab x-topic-tab-ghost"}))})),ie=Object(b.b)((function(e,t){var a;return{subscribers:Object(U.w)(t.topic)?[Object(U.k)(Object(U.j)(location.hash))]:(null===(a=e.chatSettings[t.topic])||void 0===a?void 0:a.subscribers)||[]}}))((function(e){var t=e.active,a=e.className,n=e.onClick,r=e.subscribers,c=e.topic;return o.a.createElement("div",{className:"x-subs-list ".concat(a),onClick:n},o.a.createElement("a",{className:"navbar-link"},r.length,o.a.createElement("span",{className:"is-hidden-tablet-only"},"\xa0",Object(_.a)("people chatting"))),o.a.createElement("div",{className:I()("x-has-max-width x-has-max-height navbar-dropdown is-clipped is-right",{"is-hidden-mobile":!t})},Object(U.w)(c)&&o.a.createElement("p",{className:"navbar-item is-italic"},Object(_.a)("Privately chatting with")),r.sort().map((function(e){return o.a.createElement("a",{className:"navbar-item",key:e},o.a.createElement("span",null,e))}))))})),se=a(179),le=a.n(se),oe=a(34),ue=a.n(oe),de=a(119),me=a(570),pe=a.n(me),be=["className","children"];pe.a.setAppElement(".dashboard");var fe=function(e){var t=e.className,a=void 0===t?"":t,n=e.children,r=ue()(e,be),c=Object(l.useState)(!1),i=j()(c,2),s=i[0],u=i[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement("a",le()({},r,{className:a,onClick:function(){return u(!0)}}),o.a.createElement("div",{className:"icon"},o.a.createElement(de.f,{className:"is-size-3"}))),o.a.createElement(pe.a,{isOpen:s,onRequestClose:function(){return u(!1)},contentLabel:Object(_.a)("Actions menu"),className:"x-modal x-dot-dot-dot-container"},o.a.createElement("div",{className:"x-dot-dot-dot"},o.a.createElement("div",{className:"menu"},o.a.createElement("ul",{className:"menu-list",onClick:function(){return u(!1)}},n)))))},ve=o.a.createElement("div",{className:"section"},o.a.createElement("div",{className:"icon is-large loader x-is-delayed"})),he=a(307),ge=Object(b.b)(null,(function(e){return{logout:function(){e(Object(F.i)()),Object(he.a)(100).then((function(){return ee.a.push("/login")}))}}}))((function(e){var t=e.className,a=e.children,n=e.logout;return o.a.createElement("a",{className:t,onClick:n},a)})),Ee=function(){return o.a.createElement(ge,null,Object(_.a)("Log out"))},Oe=Object(l.lazy)((function(){return a.e(19).then(a.bind(null,814))})),je=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(l.Suspense,{fallback:ve},o.a.createElement(p.Route,{path:"/chat/*",component:Oe}),o.a.createElement(p.Route,{path:"/whisper/*",component:Oe})),o.a.createElement(p.Route,{path:"/(chat|whisper)/",render:function(){return o.a.createElement("hr",{className:"is-divider menu-label"})}}),o.a.createElement(p.Route,{path:"/",component:Ee}))};function Ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=M()(e);if(t){var r=M()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return A()(this,a)}}var ye=function(e){R()(a,e);var t=Ne(a);function a(e){var n;return y()(this,a),(n=t.call(this,e)).state={topic:"",active:!1,expanded:!1},n.unlisten=ee.a.listen((function(){return n.setState({active:!1,expanded:!1})})),n.handleTopicChange=n.handleTopicChange.bind(C()(n)),n}return w()(a,[{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"handleTopicChange",value:function(e){this.setState({topic:e.target.value})}},{key:"render",value:function(){var e=this,t=Object(U.j)(location.hash),a=Object(U.g)(t),n=!t;return o.a.createElement(o.a.Fragment,{key:"header-frag"},o.a.createElement("div",{className:"navbar-brand x-navbar-brand is-inline-flex x-navbar-brand","aria-label":Object(_.a)("menu navigation"),role:"navigation"},n?o.a.createElement("span",{className:"navbar-item"},o.a.createElement("figure",{className:"image is-32x32"},o.a.createElement(z,{blue:!0})),o.a.createElement("h5",{title:a,className:"x-truncate x-truncate-limited-width title is-5 x-is-padding-left"},a||Object(_.a)("D-Chat"))):o.a.createElement("div",{className:"x-active-tabs-container navbar-tabs"},o.a.createElement(te,{className:"tabs is-toggle"},o.a.createElement(ce,null))),o.a.createElement("a",{className:I()("navbar-burger",{"is-active":this.state.active}),onClick:function(){return e.setState({active:!e.state.active,expanded:!1})},"aria-label":"menu","aria-expanded":this.state.active,role:"button"},o.a.createElement("span",{"aria-hidden":"true"}),o.a.createElement("span",{"aria-hidden":"true"}),o.a.createElement("span",{"aria-hidden":"true"}))),o.a.createElement(fe,{className:"navbar-item x-header-dots is-inline-flex","aria-label":Object(_.a)("secondary navigation"),role:"navigation",title:Object(_.a)("Chat settings")},o.a.createElement(je,null)),o.a.createElement("div",{className:I()("navbar-menu x-navbar-buttons",{"is-active":this.state.expanded||this.state.active}),role:"navigation","aria-label":"main navigation"},o.a.createElement("div",{className:"navbar-end"},o.a.createElement(ie,{className:I()("navbar-item has-dropdown is-hoverable",{"is-hidden":null==t,"is-active":this.state.expanded}),active:this.state.expanded,topic:t,onClick:function(){return e.setState({expanded:!e.state.expanded})}})),o.a.createElement("div",{className:"navbar-start is-hidden-desktop is-hidden-tablet"},o.a.createElement(m.b,{className:"navbar-item",to:"/"},Object(_.a)("Home")),o.a.createElement(m.b,{className:"navbar-item",to:"/topics"},Object(_.a)("Public")),o.a.createElement(m.b,{className:"navbar-item",to:"/options"},Object(_.a)("Options")),o.a.createElement(X,{labelClassName:"menu-label",wrapperClassName:"navbar-item"}),o.a.createElement("div",{className:"navbar-item"},o.a.createElement(Z,null)))))}}]),a}(o.a.Component),xe=a(577),we=a(591),ke=a.n(we),Ce=a(32),Se=a.n(Ce),Re=function(e){var t=e.reaction,a=e.addReaction;return o.a.createElement("button",{title:t._title.slice(0,100),className:I()("button x-has-opacity-1 button",{"is-primary":t._haveReacted,"x-reactions-reacted":t._haveReacted}),disabled:t._haveReacted,onClick:function(){return!t._haveReacted&&a({content:t.content})},type:"button"},o.a.createElement("span",{className:"x-reaction-content"},t.content),t._count>0&&o.a.createElement("span",{className:"x-is-padding-left"},t._count))},Pe=function(){return o.a.createElement("div",{className:"x-is-ack has-text-grey is-family-monospace"},"\u2714")},Ae=function(e){var t=e.addReaction,a=e.myAddr,n=e.reactions,r=Object(l.useMemo)((function(){return n.reduce((function(e,t){if(!t.content)return e;var n=t.addr===a,r=t.content,c=Object(U.d)(t.addr),i=e[r];return i?(Object(U.p)(t)||(i._count+=1,i._title+=""==i._title?c:", ".concat(c),i._haveReacted=i._haveReacted||n),e):(e[r]={content:r||"?",_isAck:Object(U.p)(t),_haveReacted:n,_count:1,_title:c},e)}),{})}),[n,a]);return o.a.createElement("div",{className:"x-reactions"},Object.values(r).map((function(e){return e._isAck?o.a.createElement(Pe,{key:e.content}):o.a.createElement(Re,{reaction:e,addReaction:t,key:e.content})})))},De=a(592),Me=a(574),Te=a.n(Me),Ie=["topic","messageID","messageEvent"];function _e(e){return""+e.addr+e.content}function Ue(e,t){var a=t.payload;switch(t.type){case"new":return Te()([].concat(Se()(e),[a]),_e);case"old":return Te()([].concat(Se()(a),Se()(e)),_e)}}var Le=Object(b.b)((function(e){return{messageEvent:e.messageEvent}}))((function(e){var t=e.topic,a=e.messageID,n=e.messageEvent,r=ue()(e,Ie),c=Object(l.useReducer)(Ue,[]),i=j()(c,2),s=i[0],u=i[1];return Object(l.useEffect)((function(){var e=!0;return Object(De.a)({topic:t,targetID:a}).then((function(t){e&&(u({type:"old",payload:t}),window.stayScrolled())})),function(){e=!1}}),[a]),Object(l.useEffect)((function(){n.reaction&&"new"===n.type&&t&&t===n.topic&&n.reaction.targetID===a&&u({type:"new",payload:n.reaction})}),[n,t,a]),o.a.createElement(Ae,le()({reactions:s},r))})),We=a(593),ze=a.n(We),Fe=function(e,t,a,n,r){return"second"===t?e<30?"".concat(Object(_.a)("< 30 s")," ").concat(a):"".concat(Object(_.a)("< 1 min")," ").concat(a):r()},Be=function(e){var t=e.date;return o.a.createElement(ze.a,{formatter:Fe,title:new Date(t).toLocaleString(),date:t,minPeriod:30})},qe=a(175),Ke=function(e){var t=e.attachment,a=Object(l.useState)(!1),n=j()(a,2),r=n[0],c=n[1];return o.a.createElement("div",{className:I()("x-media-wrapper is-flex",{"x-media-expanded":r}),title:Object(_.a)("Click to expand or contract."),onClick:function(){return c((function(e){return!e}))}},t.type.includes("audio")&&o.a.createElement("audio",{className:"x-oc-content",controls:!0,loop:!0,src:t.src})||t.type.includes("image")&&o.a.createElement("img",{className:"x-oc-content",src:t.src})||t.type.includes("video")&&o.a.createElement("video",{className:"x-oc-content",controls:!0,playsInline:!0,loop:!0,src:t.src}))},He=function(e){var t=e.attachments,a=Object(l.useState)([]),n=j()(a,2),r=n[0],c=n[1];return Object(l.useEffect)((function(){return t.forEach((function(e){return Object(qe.a)(e).then((function(e){if(e){var t=e.data,a=URL.createObjectURL(t);c([].concat(Se()(r),[{src:a,type:t.type}]))}}))})),function(){r.forEach((function(e){var t=e.src;return URL.revokeObjectURL(t)}))}}),[]),o.a.createElement("div",null,o.a.createElement("div",{className:"x-media-container is-flex"},r.map((function(e,t){return o.a.createElement("div",{key:t},o.a.createElement(Ke,{attachment:e}))}))))},Ve=a(61),Je=a(583),Ye=Object(b.b)((function(e,t){var a;return{isApproved:((null===(a=e.chatSettings[t.topic])||void 0===a?void 0:a.subscribers)||[]).includes(t.addr),amAdmin:Object(Ve.d)(t.topic,e.clients.find((function(e){return e.active})).addr)}}),(function(e,t){return{accept:function(){return e(Object(F.a)(t.addr,t.topic))},remove:function(){return e(Object(F.s)(t.addr,t.topic))}}}))((function(e){var t=e.accept,a=e.amAdmin,n=e.remove,r=e.isApproved;return o.a.createElement("div",{className:"x-admin"},o.a.createElement(Je.a,{className:"is-small",onChange:r?n:t,checked:!!r,disabled:!a,title:a?Object(_.a)("Approve to group"):Object(_.a)("You are not the channel admin")}))})),Qe=function(e){var t=e.topic,a=e.addr;return o.a.createElement("div",{className:"x-toolbar"},Object(U.t)(t)&&o.a.createElement(Ye,{addr:a,topic:t}))},Ge=a(174),Xe=a(594),Ze=a(121),$e=Object(b.b)()((function(e){var t=e.className,a=void 0===t?"":t,n=e.title,r=e.value,c=void 0===r?5:r,i=e.topic,s=e.recipientAddr,l=e.dispatch,u=e.messageID;return o.a.createElement("a",{className:a,title:n,onClick:function(){s&&l(Object(B.e)({recipient:s,content:"\u{1f3f4}\u200d\u2620\ufe0f",targetID:u,value:c,topic:i}))}},o.a.createElement("span",{className:"icon"},o.a.createElement(Ze.b,null)),o.a.createElement("span",null,Object(_.a)("Tip #value# sats").replace("#value#",c)))})),et=function(e){var t=e.closeOnClick,a=void 0===t||t,n=e.id,r=e.triggerIcon,c=e.isRight,i=void 0!==c&&c,s=e.isUp,u=void 0!==s&&s,d=e.children,m=e.triggerClassName,p=void 0===m?"is-text":m,b=Object(l.useState)(!1),f=j()(b,2),v=f[0],h=f[1],g=function(){return h(!1)},E="dropdown-"+n;return o.a.createElement("div",{className:"x-toolbar-content x-is-padding-left"},o.a.createElement("div",{className:I()("dropdown x-toolbar-buttons",{"is-active":v,"is-right":i,"is-up":u})},o.a.createElement("div",{className:"dropdown-trigger"},o.a.createElement("a",{className:"button is-small ".concat(p),"aria-haspopup":"true","aria-controls":E,onClick:function(){return h(!0)}},o.a.createElement("span",{className:"icon","aria-hidden":"true","aria-label":Object(_.a)("Open")},r)),o.a.createElement("div",{className:"dropdown-menu",id:E,role:"menu",onClick:a&&g},o.a.createElement("div",{className:"x-background",onClick:g}),o.a.createElement("div",{className:"dropdown-content"},d)))))},tt=Object(l.lazy)((function(){return Promise.all([a.e(0),a.e(2)]).then(a.bind(null,818))})),at=Object(b.b)((function(e,t){var a=t.message;return{isMyMessage:Object(Ge.a)(e.clients).addr===a.addr,id:a.id,topic:a.topic,addr:a.addr,deleted:a.deleted,muted:e.globalSettings.muted.includes(a.addr)}}),(function(e,t){return{deleteMessage:function(){return e(Object(F.d)({contentType:"event:message/delete",topic:t.message.topic,targetID:t.message.id}))},addReaction:function(a){return e(Object(F.d)({contentType:"reaction",topic:t.message.topic,targetID:t.message.id,content:a}))},toggleUserMute:function(t){return e(Object(Xe.a)(t))}}}))((function(e){var t=e.addr,a=e.addReaction,n=e.deleted,r=e.deleteMessage,c=e.id,i=e.isMyMessage,s=e.muted,u=e.toggleUserMute,d=e.topic,p=Object(l.useState)(!1),b=j()(p,2),f=b[0],v=b[1],h=function(){return v(!1)};return o.a.createElement(o.a.Fragment,null,f&&o.a.createElement(l.Suspense,{fallback:o.a.createElement("div",{className:"is-hidden"})},o.a.createElement(tt,{onSelect:function(e){a(e.native),h()},onClose:h})),o.a.createElement("div",{className:"x-message-actions x-is-hover"},o.a.createElement(et,{triggerClassName:"x-message-toolbar-side-dropdown",triggerIcon:o.a.createElement(de.c,{className:"is-size-5"}),id:"actions-".concat(c),isRight:!0,isUp:!0},o.a.createElement("a",{className:"dropdown-item",onClick:function(){return v(!0)}},o.a.createElement("span",{className:"icon"},o.a.createElement(Ze.f,null)),o.a.createElement("span",null,Object(_.a)("Add reaction"))),o.a.createElement("a",{className:"dropdown-item",onClick:function(){return a("\u{1f44d}")}},o.a.createElement("span",{className:"icon"},"\u{1f44d}"),o.a.createElement("span",null,Object(_.a)("Thumbs up"))),o.a.createElement(m.b,{to:Object(U.m)(t),className:"dropdown-item"},o.a.createElement("span",{className:"icon"},o.a.createElement(de.e,null)),o.a.createElement("span",null,Object(_.a)("Start a private conversation"))),o.a.createElement($e,{messageID:c,topic:d,recipientAddr:t,className:"dropdown-item"}),!i&&o.a.createElement("a",{className:I()("dropdown-item",{"has-text-danger":!s}),onClick:function(){return u(t)}},o.a.createElement("span",{className:"icon"},o.a.createElement(Ze.a,null)),o.a.createElement("span",null,s?Object(_.a)("Unignore user"):Object(_.a)("Ignore user"))),i&&!n&&o.a.createElement("a",{className:"dropdown-item has-text-danger",onClick:r},o.a.createElement("span",{className:"icon"},o.a.createElement(de.a,null)),o.a.createElement("span",null,Object(_.a)("Delete message"))))))})),nt=a(312),rt=function(e){var t=e.message,n="media"===t.contentType,r=t.deleted&&!t.isNotConfirmed;return a.e(18).then(a.t.bind(null,817,7)),r?o.a.createElement("div",{className:"content"},o.a.createElement("p",null,o.a.createElement("span",{className:"has-text-danger is-italic"},"<\xa0",Object(_.a)("Deleted message."),"\xa0>"))):o.a.createElement("div",null,n&&o.a.createElement(He,{attachments:t.attachments||[]}),o.a.createElement("div",{className:I()("content x-message-content x-has-normal-scrollbar",{"is-size-3":t.isOnlyEmojis}),dangerouslySetInnerHTML:{__html:t.content||""}}))},ct=function(e){var t=e.addr,a=e.ignored,n=e.refer,r=e.timestamp,c=e.unsubscribed,i=Object(U.y)(t),s=j()(i,2),u=s[0],d=s[1],m=Object(l.useState)(""),p=j()(m,2),b=p[0],f=p[1],v=Object(l.useCallback)((function(){n(t,b)}),[t,b]);return o.a.createElement("span",null,o.a.createElement("span",{onMouseDown:function(){return f(window.getSelection().toString())},title:Object(_.a)("Click to @mention"),onClick:v,className:I()("x-avatar",{"has-text-grey":c,"x-is-opaque":a})},o.a.createElement("span",{className:"x-avatar-username"},u),u?".":"",o.a.createElement("span",{className:"is-size-7 has-text-weight-normal is-italic"},null===d||void 0===d?void 0:d.slice(0,8))," "),o.a.createElement("span",{className:"has-text-grey is-size-7 x-is-padding-left"},o.a.createElement(Be,{date:r})))},it=function(e){var t=e.children,a=e.className,n=e.includeHeader,r=e.message,c=e.refer,i=e.subscribed,s=e.ignored,u=Object(l.useState)(!1),d=j()(u,2),m=d[0],p=d[1],b=r.deleted&&r.isNotConfirmed,f=Object(U.s)(r),v=n||f;return o.a.createElement("div",{className:I()("message ".concat(a),{"has-background-grey-lighter":f,"x-notice":f,"x-not-confirmed":r.isNotConfirmed,"x-message-ignored":s,"x-show-ignored":m,"x-has-header":v}),"data-not-confirmed":Object(_.a)("Message unconfirmed.")},v&&o.a.createElement("div",{className:"message-header is-paddingless has-text-weight-light"},o.a.createElement("div",{className:"level is-mobile is-marginless is-paddingless"},o.a.createElement("div",{className:"level-left"},o.a.createElement("div",{className:"level-item x-avatar-image"},o.a.createElement(nt.a,{addr:r.addr})),o.a.createElement("div",{className:"level-item"},s&&o.a.createElement("a",{className:"button is-small is-text",title:Object(_.a)("Click to display"),onClick:function(){p((function(e){return!e}))}},o.a.createElement("span",{className:"icon has-text-grey x-is-opaque"},m?o.a.createElement(Ze.d,null):o.a.createElement(Ze.e,null))),o.a.createElement(ct,{refer:c,addr:r.addr,timestamp:r.timestamp,unsubscribed:!i,ignored:s}),o.a.createElement("span",{className:"x-is-margin-left x-toolbar"},o.a.createElement(Qe,{id:r.id,topic:r.topic,addr:r.addr})))))),o.a.createElement("div",{className:I()("message-body x-is-small-padding",{"has-text-danger":b})},o.a.createElement(rt,{message:r}),t,o.a.createElement("div",{className:"x-message-toolbar-side x-is-hover"},o.a.createElement(at,{message:r}))))};function st(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function lt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?st(Object(a),!0).forEach((function(t){E()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):st(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ot=function(){var e=Object(l.useRef)();return Object(l.useEffect)((function(){var t;null===(t=e.current)||void 0===t||t.scrollIntoView()}),[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{paddingBottom:"0.5rem"},ref:e}),o.a.createElement("div",{style:{marginTop:"0.5rem"},className:"is-divider","data-content":Object(_.a)("New messages below")}))},ut=function(e){var t=e.messages,a=void 0===t?[]:t,n=e.refer,r=e.lastReadId,c=e.myAddr,i=e.createReaction,s=e.mutedUsers,u=void 0===s?[]:s,d=e.subs,m=void 0===d?[]:d;return Object(l.useMemo)((function(){for(var e=[],t=0;t<a.length;t++){for(var s=!0,l=void 0,d=a[t].id||t,p=[],b=function(){var e,d=a[t],b=Object(U.s)(d);if(l){if(Object(U.s)(l)||b||l.addr!==d.addr||!(new Date(d.timestamp)-new Date(l.timestamp)<9e4))return t--,"break";s=!1}var f=r;d.id===f&&p.push(o.a.createElement(ot,{key:"lastRead"}));var v=function(e){return i(lt(lt({},e),{},{targetID:d.id}))};l=d;var h=d.addr===c,g=!h&&(null===(e=d.content)||void 0===e?void 0:e.includes(b?Object(U.d)(c):Object(U.x)(c))),E=u.includes(d.addr)||d.hidden,O=Object(U.v)(d)||m.includes(d.addr);p.push(o.a.createElement(it,{className:I()("is-relative",{"x-me":h,"x-refers-to-me":g}),includeHeader:s,refer:n,message:d,key:d.id,topic:d.topic,addReaction:v,subscribed:O,ignored:E},o.a.createElement(Le,{addReaction:v,myAddr:c,messageID:d.id,topic:d.topic}))),t++};t<a.length;){if("break"===b())break}e.push(o.a.createElement("div",{key:"pack-"+d,className:"x-message-bundle"},p))}return e}),[a,m,r])},dt=a(596),mt=a(595),pt=a.n(mt),bt=a(605),ft=a(308),vt=function(e){var t=e.markAllMessagesRead,a=e.children,n=e.loadMore,r=e.hasMore,c=e.listClassname,i=e.scrollTriggers,s=e.topic,u=Object(l.useRef)(),d=Object(bt.a)(u,{initialScroll:1/0}),m=d.stayScrolled,p=d.isScrolled,b=d.scrollBottom;window.stayScrolled=m,Object(l.useEffect)((function(){var e=function(){!document.hidden&&p()&&t()};return document.addEventListener("visibilitychange",e),function(){document.removeEventListener("visibilitychange",e)}}),[t]),Object(l.useLayoutEffect)((function(){m(),p()&&(document.hidden||t())}),i),Object(l.useEffect)((function(){b()}),[s]);var f=Object(ft.debounce)(m,50);return o.a.createElement("div",{className:c,ref:u,id:"scroller"},o.a.createElement(dt.ResizeReporter,{onSizeChanged:f}),o.a.createElement(pt.a,{pageStart:0,isReverse:!0,loadMore:n,hasMore:r,loader:o.a.createElement("div",{className:"is-loader",key:0}),initialLoad:!1,useWindow:!1,threshold:100,className:"x-is-fullwidth"},o.a.createElement("div",{key:"chat",className:"x-chat"},a)),o.a.createElement("div",{id:"anchor"}))},ht=a(56);function gt(e,t){var a=t.payload;switch(t.type){case"modify":return e.map((function(e){return e.id===a.id?a:e}));case"new":return[].concat(Se()(e),[a]);case"old":return[].concat(Se()(a),Se()(e));case"next":return Se()(a)}}var Et=Object(b.b)((function(e,t){var a,n;return{messageEvent:e.messageEvent,unreadCount:(null===(a=e.chatSettings[t.topic])||void 0===a||null===(n=a.unread)||void 0===n?void 0:n.length)||0,mutedUsers:e.globalSettings.muted}}))((function(e){var t=e.createReaction,a=e.lastReadId,n=e.markAllMessagesRead,r=e.messageEvent,c=e.mutedUsers,i=e.myAddr,s=e.refer,u=e.subs,d=e.topic,m=e.unreadCount,p=Object(l.useReducer)(gt,[]),b=j()(p,2),f=b[0],v=b[1],h=Object(l.useState)(!0),g=j()(h,2),E=g[0],O=g[1],N=Object(l.useCallback)((function(){var e;if(d){var t=d===(null===(e=f[0])||void 0===e?void 0:e.topic)?f[0]:void 0;Object(ht.c)({topic:d,previous:t}).then((function(e){e.length<ht.a&&O(!1),v({type:"old",payload:e})}))}}),[d,f[0]]);return Object(l.useEffect)((function(){r.message&&d&&d===r.topic&&v({type:r.type,payload:r.message})}),[r,d]),Object(l.useEffect)((function(){d&&Object(ht.c)({topic:d,extra:m}).then((function(e){v({type:"next",payload:e})})).then((function(){return O(!0)}))}),[d]),o.a.createElement(vt,{listClassname:"x-is-fullwidth is-scrollable is-relative x-chatroom-messages",scrollTriggers:[d,f.length],markAllMessagesRead:n,topic:d,loadMore:N,hasMore:E},o.a.createElement(ut,{messages:f,refer:s,lastReadId:a,subs:u,topic:d,myAddr:i,createReaction:t,mutedUsers:c}))})),Ot=a(597),jt=a.n(Ot),Nt=a(47),yt=a(598),xt=a.n(yt);a(644);function wt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function kt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(a),!0).forEach((function(t){E()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ct=Object(l.lazy)((function(){return Promise.all([a.e(0),a.e(2)]).then(a.bind(null,818))})),St=function(){var e=r()(i.a.mark((function e(t,a,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(function(e){if(e.target.files.length){if(!["image/","video/","audio/"].some((function(t){var a;return null===(a=e.target.files[0].type)||void 0===a?void 0:a.startsWith(t)})))return void n(Object(_.a)("Wrong filetype."));var t=new FileReader;t.onload=function(e){a(e.target.result)},t.onerror=function(e){console.error("FileReader error:",e),n(Object(_.a)("Error"))},e.target.files[0].size<=2097152?t.readAsDataURL(e.target.files[0]):n(Object(_.a)("Error, file is too large. Max #size# MB.").replace("#size#",2))}})({target:{files:[t]}});case 2:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),Rt=function(e){var t=e.submitText,n=e.mdeInstance,c=e.placeholder,s=e.submitUpload,u=e.subs,d=e.topic;a.e(22).then(a.t.bind(null,819,7)),a.e(17).then(a.t.bind(null,820,7));var m=Object(l.useState)(!1),p=j()(m,2),b=p[0],f=p[1];Object(l.useEffect)((function(){var e,t=null===(e=n.current)||void 0===e?void 0:e.codemirror;t&&(t.doc.setCursor(1/0,1/0),t.focus())}),[d]),Object(l.useEffect)((function(){var e,t=null===(e=n.current)||void 0===e?void 0:e.codemirror;if(t){var c=function(){t.showHint({completeSingle:!1,hint:function(){var e=r()(i.a.mark((function e(){var n,r,c,s,l,o,d,m,p,b,f,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getCursor(),r=n.ch,c=n.line,s=t.findWordAt(n),l=kt(kt({},s.anchor),{},{ch:s.anchor.ch-1}),!(o=t.getRange(l,s.head).trimLeft()).startsWith(":")){e.next=17;break}return d=o.slice(1),e.next=10,a.e(0).then(a.bind(null,813));case 10:if(m=e.sent,p=m.emojiIndex,!((b=p.search(d||"smile").map((function(e){return{text:e.native,displayText:"".concat(e.native," ").concat(e.colons)}}))).length>=1)){e.next=15;break}return e.abrupt("return",{list:b,from:d?l:s.anchor,to:Object(Nt.Pos)(c,r)});case 15:e.next=22;break;case 17:if(!o.startsWith("@")){e.next=22;break}if(f=o.slice(1),!(v=jt()(u.map(U.d)).filter((function(e){return e.toLowerCase().startsWith(f.toLowerCase())})).map((function(e){return{text:Object(U.x)(e)+" ",displayText:Object(U.d)(e)}}))).length){e.next=22;break}return e.abrupt("return",{list:v,from:f?l:s.anchor,to:Object(Nt.Pos)(c,r)});case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})};return t.on("inputRead",c),function(){t.off("inputRead",c)}}}),[u]);var v=function(e){var a=e.codemirror;t(a.getValue()),a.setValue(""),localStorage["smde_main-textarea"]="",a.focus()};Object(l.useEffect)((function(){var e,t=null===(e=n.current)||void 0===e?void 0:e.codemirror;if(t){var a=function(){document.querySelector(".editor-statusbar").className="editor-statusbar is-not-hidden"},r=function(){document.querySelector(".editor-statusbar").className="editor-statusbar"};return t.on("dragenter",a),t.on("drop",r),function(){t.off("dragenter",a),t.off("drop",r)}}}),[d]);return o.a.createElement(o.a.Fragment,null,b&&o.a.createElement(l.Suspense,{fallback:o.a.createElement("div",{className:"is-hidden"})},o.a.createElement(Ct,{onClose:function(){return f(!1)},onSelect:function(e){return n.current.codemirror.replaceSelection(e.native)}})),o.a.createElement(xt.a,{key:d,id:"main-textarea",options:{autofocus:!0,placeholder:c,autoDownloadFontAwesome:!1,uploadImage:!0,imageUploadFunction:function(e,t,a){document.querySelector(".editor-statusbar").className="editor-statusbar is-not-hidden",setTimeout((function(){return St(e,(function(e){t(e),s(),document.querySelector(".editor-statusbar").className="editor-statusbar"}),a)}),30)},imageAccept:"image/*,audio/*,video/*",imageMaxSize:2097152,status:["upload-image"],toolbarTips:!1,onToggleFullScreen:function(){var e;null===(e=n.current)||void 0===e||e.codemirror.focus()},imageTexts:{sbInit:Object(_.a)("Post media by pasting or dropping it in the textarea."),sbOnDragEnter:Object(_.a)("Drop media to upload."),sbOnDrop:Object(_.a)("Uploading #images_names#."),sbProgress:Object(_.a)("Uploading #file_name#: #progress#%."),sbOnUploaded:Object(_.a)("Uploaded #image_name#.")},autosave:{enabled:!U.c,delay:1500,uniqueId:"main-textarea"},errorCallback:function(e){var t,a;null===(t=n.current)||void 0===t||null===(a=t.setStatusbar)||void 0===a||a.call(t,"upload-image",e)},previewClass:"content editor-preview",promptURLs:U.c,spellChecker:!1,minHeight:"auto",toolbar:[{name:I()("emoji x-fullscreen-visible",{"is-hidden-touch":U.c}),action:function(){return f(!0)},className:"fa fa-smile",title:""},"|","bold","italic","heading","quote","|","link","upload-image","|","side-by-side","fullscreen",{name:I()("submit x-fullscreen-visible is-hidden-tablet"),action:v,className:"fa fa-paper-plane-empty",title:""}]},extraKeys:{Enter:function(e){var t=n.current;if(null!==t&&void 0!==t&&t.isFullscreenActive()){var a=e.getDoc(),r=a.getCursor(),c=a.getLine(r.line),i={line:r.line,ch:c.length};a.replaceRange("\n",i)}else v(t)}},className:"x-main-editor",getMdeInstance:function(e){return n.current=e}}))};function Pt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function At(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(a),!0).forEach((function(t){E()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Pt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Dt=function(e){var t=e.client,a=e.subs,n=e.createMessage,r=e.topic,c=e.markAsRead,i=e.unreadMessages,s=e.getSubscribers,u=e.chatType,d=Object(l.useState)(i[0]),m=j()(d,2),p=m[0],b=m[1],f=function(){return s(u,r)},v=Object(xe.a)(f,1e4),h=v.start,g=v.stop,E=Object(l.useRef)(),O=Object(l.useMemo)((function(){return Object(_.a)("Message #topic# as #user_identifier#...").replace("#topic#",ke()(Object(U.g)(r),8)).replace("#user_identifier#",t.addr.slice(0,8))}),[r,t.addr]);Object(l.useEffect)((function(){var e=Object(U.g)(r);return document.title="(".concat(i.length,") ").concat(e," - ").concat(Object(_.a)("D-Chat")),function(){document.title=Object(_.a)("D-Chat")}}),[i.length,r]),Object(l.useEffect)((function(){return f(),h(),b(i[0]),function(){g()}}),[r]);var N=Object(l.useCallback)((function(){i.length>0&&c(r,i)}),[r,i]),y=Object(l.useCallback)((function(e){""!==(e=e.trim())&&n(u,{content:e,contentType:"text",topic:r})}),[r,u]),x=Object(l.useCallback)((function(){var e,t=null===(e=E.current)||void 0===e?void 0:e.codemirror;if(t){var a=t.getValue();if(/(data:video|data:audio|data:image)/.test(a)){var c=a.trim();if(c)n(u,{content:c,contentType:"media",topic:r}),t.setValue("")}}}),[r,u]),w=Object(l.useCallback)((function(e){n(u,At(At({},e),{},{topic:r,contentType:"reaction"}))}),[r,u]);return o.a.createElement("div",{className:"x-chatroom"},o.a.createElement(Et,{topic:r,refer:function(e,t){return function(e){var t,a=null===(t=E.current)||void 0===t?void 0:t.codemirror;a&&(a.replaceSelection(e),a.focus())}(function(e,t){return t?"> ".concat(Object(U.x)(e),":\n").concat(t.replace(/^/gm,"> "),"\n\n"):Object(U.x)(e)+" "}(e,t))},subs:a,lastReadId:p,markAllMessagesRead:N,myAddr:t.addr,createReaction:w}),o.a.createElement(Rt,{submitText:y,mdeInstance:E,placeholder:O,submitUpload:x,subs:a,topic:r}))},Mt=Object(b.b)((function(e,t){var a,n,r,c=Object(U.j)(t.location.pathname),i=Object(U.w)(c)?Object(U.k)(c):null;return{client:e.clients.find((function(e){return e.active})),subs:(null===(a=e.chatSettings[c])||void 0===a?void 0:a.subscribers)||[i,null===(n=e.login)||void 0===n?void 0:n.addr],topic:c,unreadMessages:(null===(r=e.chatSettings[c])||void 0===r?void 0:r.unread)||[],chatType:Object(U.w)(c)?"whisper":"chat"}}),(function(e){return{createMessage:function(t,a){var n;return"chat"===t?n=Object(F.o)(a):"whisper"===t&&(n=Object(F.t)(a)),e(n)},getSubscribers:function(t,a){if("chat"===t)return e(Object(F.f)(a))},markAsRead:function(t,a){return e(Object(F.j)(t,a))}}}))(Dt),Tt=Object(l.lazy)((function(){return Promise.all([a.e(14),a.e(16)]).then(a.bind(null,821))})),It=Object(l.lazy)((function(){return Promise.all([a.e(9),a.e(21)]).then(a.bind(null,815))})),_t=Object(l.lazy)((function(){return a.e(20).then(a.bind(null,816))})),Ut=function(){return o.a.createElement(l.Suspense,{fallback:ve},o.a.createElement(p.Switch,null,o.a.createElement(p.Route,{path:"/(chat|whisper)/*",component:Mt}),o.a.createElement(p.Route,{path:"/topics",component:It}),o.a.createElement(p.Route,{path:"/options",component:_t}),o.a.createElement(p.Route,{path:"/",component:Tt})))},Lt=function(){return o.a.createElement(o.a.Fragment,null,Object(u.createPortal)(o.a.createElement($,null),document.getElementById("sidebar-root")),Object(u.createPortal)(o.a.createElement(ye,null),document.getElementById("header-root")),Object(u.createPortal)(o.a.createElement(Ut,null),document.getElementById("chatroom-root")))},Wt=(a(646),function(){var e=r()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(){var e=Object(U.j)(location.hash);null!=e&&t.dispatch(Object(F.g)(e))},ee.a.listen((function(){a(),U.c||t.dispatch(Object(F.n)(location.hash.slice(1)))})),d.a.render(o.a.createElement(b.a,{store:t},o.a.createElement(m.a,null,o.a.createElement(p.Switch,null,o.a.createElement(p.Route,{path:"/login",component:J}),o.a.createElement(h,{path:"/",component:Lt})))),document.getElementById("root"));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),zt=function(){var e=r()(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default;case 2:t=e.sent,Wt(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t.a=zt}}]);