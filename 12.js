(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{10:function(t,e,n){"use strict";n.d(e,"n",(function(){return u})),n.d(e,"i",(function(){return s})),n.d(e,"b",(function(){return d})),n.d(e,"t",(function(){return p})),n.d(e,"f",(function(){return f})),n.d(e,"v",(function(){return l})),n.d(e,"g",(function(){return b})),n.d(e,"c",(function(){return O})),n.d(e,"u",(function(){return y})),n.d(e,"h",(function(){return h})),n.d(e,"o",(function(){return v})),n.d(e,"d",(function(){return E})),n.d(e,"p",(function(){return A})),n.d(e,"l",(function(){return g})),n.d(e,"j",(function(){return S})),n.d(e,"k",(function(){return j})),n.d(e,"x",(function(){return m})),n.d(e,"r",(function(){return T})),n.d(e,"y",(function(){return w})),n.d(e,"e",(function(){return _})),n.d(e,"w",(function(){return I})),n.d(e,"m",(function(){return C})),n.d(e,"q",(function(){return k})),n.d(e,"a",(function(){return P})),n.d(e,"s",(function(){return R}));var r=n(7),c=n.n(r),a=n(2);function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var u=function(t){return{type:"ui/NAVIGATED",payload:{to:t}}},s=function(){return{type:"LOGOUT_ALIAS"}},d=function(){return{type:"CONNECTED"}},p=function(t,e){return{type:"SEND_PRIVATE_MESSAGE_ALIAS",payload:{recipient:Object(a.k)(t.topic),message:i(i({},t),{},{topic:void 0,isPrivate:!!Object(a.v)(t)||void 0}),options:e}}},f=function(t){return{type:"chat/GET_SUBSCRIBERS_ALIAS",payload:{topic:Object(a.h)(t)}}},l=function(t,e){return{type:"chat/SET_SUBSCRIBERS",payload:{topic:t,subscribers:e}}},b=function(t){return{type:"JOIN_CHAT_ALIAS",payload:{topic:Object(a.h)(t)}}},O=function(t){return{type:"chat/CREATE_CHAT",payload:{topic:Object(a.h)(t)}}},y=function(t){return{type:"LOGIN_STATUS",error:t.error,payload:{addr:t.addr}}},h=function(t,e,n){return{type:"LOGIN_ALIAS",payload:{credentials:t,seed:n,address:e}}},v=function(t){return{type:"PUBLISH_MESSAGE_ALIAS",payload:{message:t,topic:Object(a.h)(t.topic)}}},E=function(t){return Object(a.v)(t)?p(t):v(t)},A=function(t){var e="chat/RECEIVE_MESSAGE";return"reaction"===t.contentType&&(e="chat/RECEIVE_REACTION"),{type:e,payload:{message:t,topic:Object(a.h)(t.topic)}}},g=function(t){return{type:"chat/MODIFY_MESSAGE",payload:{topic:Object(a.h)(t.topic),message:t}}},S=function(t,e){return{type:"chat/MARK_READ",payload:{topic:t,ids:e}}},j=function(t,e){return{type:"chat/MARK_UNREAD",payload:{topic:t,message:e}}},m=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:"SUBSCRIBE_TO_CHAT_ALIAS",payload:{topic:t,options:e}}},T=function(t){return{type:"chat/REMOVE",payload:{topic:t}}},w=function(t){return{type:"chat/UNSUBSCRIBE_ALIAS",payload:{topic:t}}},_=function(t){return{type:"chat/FETCH_SUBSCRIPTION_INFOS_ALIAS",payload:{topic:t}}},I=function(t,e){return{type:"chat/SET_SUBSCRIPTION_INFOS",payload:{topic:t,data:e}}},C=function(t,e){return{type:"chat/SET_CHAT_MUTE",payload:{topic:t,muted:e}}},k=function(t){return{type:"ui/REMOVE_ACTIVE_TOPIC",payload:{topic:t}}},P=function(t,e){return{type:"chat/ACCEPT_TO_CHATROOM_ALIAS",payload:{addr:t,topic:e}}},R=function(t,e){return{type:"chat/REMOVE_ACCEPT_TO_CHATROOM_ALIAS",payload:{addr:t,topic:e}}}},15:function(t,e,n){"use strict";var r={$loaded:Promise.resolve(),clientsMeta:[],globalSettings:{muted:[]},chatSettings:{},notifications:!1,audioNotifications:!0},c=localStorage.getItem("dchat");c&&(c=JSON.parse(c),r.clientsMeta=c?[c]:[]);var a,o=localStorage.getItem("dchatv2");o&&((r=JSON.parse(o)).$loaded=Promise.resolve()),a=Proxy?new Proxy(r,{set:function(t,e,n){return"$loaded"!==e&&(t[e]=n,localStorage.setItem("dchatv2",JSON.stringify(t))),!0}}):r,e.a=a},174:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var r=n(32),c=n.n(r),a=n(7),o=n.n(a),i=n(15);function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){o()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t){return t.map((function(t){return s(s({},t),{},{active:!1})}))}function p(t){return t.find((function(t){return t.active}))}e.b=function(){var t,e,n,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1?arguments[1]:void 0;switch(o.type){case"nkn/DEACTIVATE_CLIENTS":t=d(a);break;case"nkn/ACTIVATE_CLIENT":n=o.payload.client.wallet.Address,-1===(r=(t=d(a)).findIndex((function(t){return t.wallet.Address===n})))?(e=s(s({},o.payload.client),{},{createdAt:Date.now(),active:!0}),t=[].concat(c()(t),[e])):t[r]=s(s(s({},t[r]),o.payload.client),{},{active:!0}),i.a.clientsMeta=t;break;case"nkn/SET_BALANCE":n=o.payload.address,t=a.map((function(t){var e=s({},t);return e.wallet.Address===n&&(e.balance=o.payload.balance),e})),i.a.clientsMeta=t;break;default:t=a}return t}},175:function(t,e,n){"use strict";n.d(e,"b",(function(){return b})),n.d(e,"a",(function(){return O}));var r=n(9),c=n.n(r),a=n(3),o=n.n(a),i=n(81),u=n.n(i),s=n(20),d=n(117),p=n.n(d),f=n(118),l=n.n(f);function b(t){var e=u()(t),n=l()(t);return t=t.slice(t.indexOf(",")+1),t=p()(t,n),s.a.attachments.add({hash:e,data:t}).catch((function(){})),e}function O(t){return y.apply(this,arguments)}function y(){return(y=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",s.a.attachments.get({hash:e}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},2:function(t,e,n){"use strict";n.d(e,"w",(function(){return s})),n.d(e,"v",(function(){return d})),n.d(e,"k",(function(){return p})),n.d(e,"e",(function(){return f})),n.d(e,"g",(function(){return l})),n.d(e,"i",(function(){return b})),n.d(e,"h",(function(){return O})),n.d(e,"y",(function(){return y})),n.d(e,"d",(function(){return h})),n.d(e,"f",(function(){return v})),n.d(e,"m",(function(){return E})),n.d(e,"l",(function(){return A})),n.d(e,"o",(function(){return g})),n.d(e,"s",(function(){return S})),n.d(e,"r",(function(){return j})),n.d(e,"q",(function(){return m})),n.d(e,"a",(function(){return T})),n.d(e,"b",(function(){return w})),n.d(e,"p",(function(){return _})),n.d(e,"x",(function(){return I})),n.d(e,"c",(function(){return C})),n.d(e,"j",(function(){return k})),n.d(e,"t",(function(){return P})),n.d(e,"u",(function(){return R})),n.d(e,"n",(function(){return N}));var r,c=n(17),a=n.n(c),o=n(81),i=n.n(o),u=n(58),s=function(t){return!(null===t||void 0===t||!t.startsWith("/whisper/"))},d=function(t){return s(t.topic)},p=function(t){return s(t)?t.slice("/whisper/".length):t};function f(t){return t?t.startsWith("dchat")&&45===t.length?t:"dchat"+i()(t):null}function l(t){return t?s(t)?p(t):t:""}function b(t){if(!t)throw new Error("No topic: "+t);return s(t)?E(t):"/chat/"+t}function O(t){return t||null}var y=function(t){if(!t)return["",""];var e=t.lastIndexOf("."),n=t,r="";return-1!==e&&(r=t.substring(0,e),n=t.slice(e+1)),[r,n]},h=function(t){if(!t)return!1;var e=y(t),n=a()(e,2),r=n[0],c=n[1];return r||c.slice(0,8)},v=function(t){var e=y(t),n=a()(e,2)[1];return u.Wallet.publicKeyToAddress(n)};function E(t){var e=p(t);return"/whisper/".concat(e)}function A(t){return E(t)}var g=function(t){return new Promise((function(e,n){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=n,r.readAsText(t)}))},S=function(t){return t&&["event:subscribe","dchat/subscribe"].includes(t.contentType)},j=function(t){return t&&["event:message/delete","message/delete"].includes(t.contentType)},m=function(t){return t&&["contact"].includes(t.contentType)},T="__dchat",w=!1,_=function(t){return"\u2714"===(null===t||void 0===t?void 0:t.content)},I=function(t){return"@"+h(t)},C=!1===(null===(r=location)||void 0===r?void 0:r.href.includes("popup.html"));function k(t){var e=(t=t.replace(/^#/,"")).slice(0,t.indexOf("/",t.indexOf("/")+1)+1),n=t.slice(e.length);try{n=decodeURIComponent(n)}catch(r){}switch(e){case"/chat/":return n;case"/whisper/":return A(n)}}function P(t){return!s(t)&&(64===(t=t.slice(t.lastIndexOf(".")+1)).length&&t)}function R(t){return!s(t)}var N=function(){var t=Date.now();return 968971+Math.floor((t-1583501622400)/21575)}},20:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o}));var r=n(120),c=new r.a("dchat");c.version(1).stores({attachments:"++id,&hash"}),c.version(2).stores({messages:"[topic+id+addr], [topic+createdAt], createdAt",reactions:"[topic+id+addr], [topic+targetID]"}),c.version(3).stores({contacts:"addr"});var a=r.a.maxKey,o=r.a.minKey;e.a=c},301:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=new Audio("img/when.ogg");r.volume=.2;var c=function(){r.play()}},311:function(t,e,n){"use strict";n.r(e);var r=n(9),c=n.n(r),a=n(3),o=n.n(a),i=n(80),u=n(302),s=n(303),d=n(55),p=n(183),f=function(t){if(localStorage.getItem("dchat")){var e=JSON.parse(localStorage.getItem("dchat"));t.dispatch(Object(d.a)(e))}else var n,r=t.subscribe((function(){var e;if(n!==(n=null===(e=t.getState().clients[0])||void 0===e?void 0:e.addr)){var c=t.getState().clients[0];localStorage.setItem("dchat",JSON.stringify(c)),r()}}))},l=n(304),b=n.n(l),O=n(32),y=n.n(O),h=n(7),v=n.n(h),E=n(15),A=n(174);function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){v()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j=Object(i.combineReducers)({login:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"LOGIN":t=n.payload.credentials;break;case"LOGIN_STATUS":t=n.error?{error:n.error}:n.payload;break;case"CONNECTED":t=S(S({},e),{},{connected:!0});break;case"LOGOUT":t={};break;default:t=e}return t},clients:A.b,chatSettings:function(){var t,e,n,r,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,o=null===(t=a.payload)||void 0===t?void 0:t.topic;switch(a.type){case"chat/REMOVE":n=S(S({},c),{},v()({},o,S(S({},c[o]),{},{unread:[],hidden:!0}))),E.a.chatSettings=n;break;case"chat/RECEIVE_MESSAGE":n=S(S({},c),{},v()({},o,S(S({},c[o]),{},{receivedAt:Date.now(),hidden:!1}))),E.a.chatSettings=n;break;case"chat/MARK_UNREAD":r=(null===(e=c[o])||void 0===e?void 0:e.unread)||[],n=S(S({},c),{},v()({},o,S(S({name:o},c[o]),{},{unread:[].concat(y()(r),[a.payload.message.id])}))),E.a.chatSettings=n;break;case"chat/MARK_READ":n=S(S({},c),{},v()({},o,S(S({},c[o]),{},{unread:[]}))),E.a.chatSettings=n;break;case"chat/CREATE_CHAT":n=S(S({},c),{},v()({},o,S(S({name:o,unread:[],subscribers:[],subscribersMeta:[],receivedAt:1},c[o]),{},{hidden:!1}))),E.a.chatSettings=n;break;case"chat/SET_SUBSCRIBERS":n=S(S({},c),{},v()({},o,S(S({},c[o]),{},{subscribers:a.payload.subscribers})));break;case"chat/SET_SUBSCRIPTION_INFOS":n=S(S({},c),{},v()({},o,S(S({unread:[],subscribers:[]},c[o]),{},{subscribersMeta:a.payload.data})));break;case"chat/SET_CHAT_MUTE":n=S(S({},c),{},v()({},o,S(S({},c[o]),{},{muted:a.payload.muted}))),E.a.chatSettings=n;break;default:n=c}return n},messageEvent:function(t,e){var n={};switch(e.type){case"chat/MODIFY_MESSAGE":n={topic:e.payload.topic,message:e.payload.message,type:"modify"};break;case"chat/RECEIVE_MESSAGE":n={topic:e.payload.topic,message:e.payload.message,type:"new"};break;case"chat/RECEIVE_REACTION":n={topic:e.payload.topic,reaction:e.payload.message,type:"new"};break;default:n={}}return n},globalSettings:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{muted:[]},n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"settings/TOGGLE_USER_MUTE":t=e.muted.includes(n.payload.addr)?S(S({},e),{},{muted:e.muted.filter((function(t){return t!==n.payload.addr}))}):S(S({},e),{},{muted:[].concat(y()(e.muted),[n.payload.addr])}),E.a.globalSettings=t;break;default:t=e}return t},contactEvent:function(t,e){var n;switch(e.type){case"contacts/UPDATE_CONTACT":n=e.payload.contact;break;default:n={}}return n},navigation:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{mostRecentPage:"/"},n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"ui/NAVIGATED":t=S(S({},e),{},{mostRecentPage:n.payload.to});break;default:t=e}return t},activeTopics:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,c=null===(t=r.payload)||void 0===t?void 0:t.topic;switch(r.type){case"chat/CREATE_CHAT":(e=new Set(n)).add(c),e=Array.from(e);break;case"ui/REMOVE_ACTIVE_TOPIC":case"chat/REMOVE":e=n.filter((function(t){return t!==c}));break;default:e=n}return e}}),m=n(10),T=n(2),w=n(116),_=n.n(w);function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){v()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var k=function(t){return function(e,n){var r;if(null===(r=t.meta)||void 0===r||!r.WebWorker){var c,a,o="LOGIN_ALIAS"===t.type&&(null===(c=n().clients.find((function(e){return e.wallet.Address===t.payload.address})))||void 0===c?void 0:c.wallet);switch(e(C(C({},t),{},{payload:C({wallet:o},t.payload),meta:C(C({},t.meta),{},{WebWorker:!0})})),t.type){case"LOGOUT_ALIAS":localStorage.clear();break;case"LOGIN_ALIAS":(a=t.payload.credentials).rememberMe&&_.a.encrypt("d-chat!!!",a).then((function(t){return localStorage.setItem("credentials",JSON.stringify(t))}))}}}},P={PUBLISH_MESSAGE_ALIAS:k,LOGIN_ALIAS:k,"chat/GET_SUBSCRIBERS_ALIAS":k,LOGOUT_ALIAS:k,"nkn/GET_BALANCE_ALIAS":k,"nkn/NEW_TRANSACTION_ALIAS":k,SUBSCRIBE_TO_CHAT_ALIAS:k,SEND_PRIVATE_MESSAGE_ALIAS:k,"chat/MAYBE_OFFER_SUBSCRIBE_ALIAS":k,"chat/FETCH_SUBSCRIPTION_INFOS_ALIAS":k,"chat/UNSUBSCRIBE_ALIAS":k,"chat/ACCEPT_TO_CHATROOM_ALIAS":k,"chat/REMOVE_ACCEPT_TO_CHATROOM_ALIAS":k,"contacts/REQUEST_CONTACT":k,"contacts/SEND_CONTACT_INFO":k,JOIN_CHAT_ALIAS:function(t){return function(e){var n=t.payload.topic;n&&(e(Object(m.c)(n)),Object(T.u)(n)&&e(Object(m.x)(n)))}}},R=n(305),N=n.n(R),D=n(4),x=function(t){return Object.values(t.chatSettings).reduce((function(t,e){return e.muted?t:t+((null===(n=e.unread)||void 0===n?void 0:n.length)||0);var n}),0)},L=function(t){return function(e){return function(n){var r,c,a,o,i,u=null===(r=n.payload)||void 0===r?void 0:r.message,s=null===(c=n.payload)||void 0===c?void 0:c.topic,d=t.getState(),p=(null===u||void 0===u?void 0:u.content)||"";switch(n.type){case"chat/RECEIVE_MESSAGE":null!==(a=Object(D.c)())&&void 0!==a&&a.includes(u.topic)||!function(t){return!Object(T.s)(t)&&!t.isMe&&!t.ignored}(u)||t.dispatch(Object(m.k)(u.topic,u)),i=u,Object(T.s)(i)||Object(T.r)(i)||!Object(T.v)(i)||i.ignored||function(e){var n=e.id,r=e.topic;e.isMe||t.dispatch(Object(m.t)({contentType:"receipt",topic:r,targetID:n}))}(u);break;case"chat/MARK_UNREAD":p="media"===u.contentType?Object(D.a)("Posted media."):N()(p),null!==(o=d.chatSettings[s])&&void 0!==o&&o.muted&&!u.refersToMe||(Object(D.b)({message:p,title:u.title||"".concat(Object(D.a)("D-Chat")," ").concat(Object(T.g)(u.topic),", ").concat(Object(T.d)(u.addr),":")}),Object(D.f)(x(d)+1));break;case"chat/MARK_READ":Object(D.f)(x(d)-n.payload.ids.length)}e(n)}}},M=n(56),G=n(175);function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function B(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){v()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var V=[];function H(t){return F.apply(this,arguments)}function F(){return(F=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.unreceivable){t.next=11;break}if(!e.modifications){t.next=5;break}return e.isNotConfirmed||(e.modifications=B(B({},e.modifications),e.modifications._onConfirm)),delete e.modifications._onConfirm,t.abrupt("return",Object(M.d)({topic:e.topic,id:e.targetID,addr:e.addr},B({isNotConfirmed:e.isNotConfirmed},e.modifications)).then((function(t){return t&&[Object(m.l)(t)]})));case 5:if("media"===e.contentType&&(e.attachments=e.attachments.map((function(t){return Object(G.b)(t)}))),Object(M.e)(e),!V.includes(e.id)){t.next=10;break}return V=V.filter((function(t){return t!==e.id})),t.abrupt("return",[Object(m.l)(e)]);case 10:e.isNotConfirmed&&V.push(e.id);case 11:return t.abrupt("return",[]);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var W=function(){var t=c()(o.a.mark((function t(e){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(M.b)(e);case 2:return n=t.sent,t.abrupt("return",null!=n||Object(T.r)(e));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),J=function(t){return function(e){return function(){var n=c()(o.a.mark((function n(r){var c,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=!1,n.t0=r.type,n.next="chat/RECEIVE_MESSAGE"===n.t0||"chat/RECEIVE_REACTION"===n.t0?4:10;break;case 4:return c=r.payload.message,n.next=7,W(c);case 7:return a=n.sent,H(c).then((function(e){return e.forEach((function(e){return t.dispatch(e)}))})),n.abrupt("break",10);case 10:a||e(r);case 11:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()}},K=function(t){return function(e){return function(n){switch(n.type){case"chat/RECEIVE_MESSAGE":case"chat/RECEIVE_REACTION":t.getState().globalSettings.muted.includes(n.payload.message.addr)&&(n.payload.message.ignored=!0)}e(n)}}},q=function(t){return function(e){return function(n){var r,c=null===(r=n.payload)||void 0===r?void 0:r.message;return"chat/RECEIVE_MESSAGE"===n.type&&Object(T.s)(c.contentType)&&c.topic&&t.dispatch(Object(m.f)(c.topic)),e(n)}}},Q=n(46),$=n(59),Y=function(t){return function(e){return function(){var n=c()(o.a.mark((function n(r){var c,a,i,u,s,d,p,f,l,b;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(c=r.type)||void 0===c||!c.startsWith("contacts")){n.next=42;break}a=r.payload.contact,i=a.requestType,u=r.payload.addr,s=a.addr,n.t0=c,n.next="contacts/RECEIVE_CONTACT_REQUEST"===n.t0?9:"contacts/UPDATE_CONTACT"===n.t0?29:40;break;case 9:n.t1=i,n.next="header"===n.t1?12:"full"===n.t1?21:26;break;case 12:return n.next=14,Object(Q.a)(u);case 14:if(n.t2=n.sent,n.t2){n.next=17;break}n.t2={};case 17:return l=n.t2,d=l.version,t.dispatch(Object($.c)(s,{version:d})),n.abrupt("break",28);case 21:return n.next=23,Object(Q.b)(u);case 23:return p=n.sent,t.dispatch(Object($.c)(s,p)),n.abrupt("break",28);case 26:return console.log("D-Chat: Some odd type came up:",r),n.abrupt("break",28);case 28:return n.abrupt("return");case 29:n.t3=i,n.next="response/header"===n.t3?32:"response/full"===n.t3?37:39;break;case 32:return n.next=34,Object(Q.a)(a.addr);case 34:return(f=n.sent)&&f.version===a.version?Object(Q.c)(f):t.dispatch(Object($.b)(a.addr,"full")),n.abrupt("return");case 37:return Object(Q.c)(r.payload.contact),n.abrupt("break",39);case 39:return n.abrupt("break",40);case 40:n.next=43;break;case 42:"chat/RECEIVE_MESSAGE"===c&&X((b=r.payload.message).addr).then((function(e){return e&&t.dispatch(Object($.b)(b.addr,"header"))}));case 43:return n.abrupt("return",e(r));case 44:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()}},z={};function X(t){return Z.apply(this,arguments)}function Z(){return(Z=c()(o.a.mark((function t(e){var n,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!z[e]){t.next=2;break}return t.abrupt("return",!1);case 2:return z[e]=!0,t.next=5,Object(Q.a)(e);case 5:if(t.t0=t.sent,t.t0){t.next=8;break}t.t0={};case 8:if(n=t.t0,(r=n.expiresAt)&&!(r>Date.now())){t.next=12;break}return t.abrupt("return",!0);case 12:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var tt,et=new Worker("dchat-nkn-worker-injector.js"),nt=b()(et);if(T.b&&(tt=localStorage.getItem("credentials")))try{tt=JSON.parse(tt)}catch(ct){tt=void 0}var rt=E.a.$loaded.then(c()(o.a.mark((function t(){var e,n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={clients:E.a.clientsMeta,chatSettings:E.a.chatSettings,globalSettings:E.a.globalSettings},n=Object(i.createStore)(j,e,Object(u.composeWithDevTools)(Object(i.applyMiddleware)(nt,Object(p.alias)(P),K,Y,J,L,q,s.a))),f(n),T.b&&tt&&_.a.decrypt("d-chat!!!",tt).then((function(t){var e=n.getState().clients.find((function(t){return t.active})),r=null===e||void 0===e?void 0:e.wallet.Address;r&&n.dispatch(Object(m.h)(t,r))})),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)}))));e.default=rt},4:function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"f",(function(){return f})),n.d(e,"b",(function(){return l})),n.d(e,"c",(function(){return b})),n.d(e,"d",(function(){return O})),n.d(e,"e",(function(){return y}));var r=n(9),c=n.n(r),a=n(3),o=n.n(a),i=n(301),u=n(306),s=n.n(u),d=n(15);function p(t){return t}var f=function(){},l=s()((function(t){if(d.a.audioNotifications&&Object(i.a)(),d.a.notifications&&t.message)return new Notification(t.title||"D-Chat",{body:t.message||"",icon:"/img/NKN_DCHAT-128-128-border16.png"})}),250,{trailing:!1}),b=function(){return""},O=function(){},y=function(){var t=c()(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Notification){t.next=2;break}throw new Error("No Notifications");case 2:return t.next=4,Notification.requestPermission();case 4:if("granted"!==t.sent){t.next=9;break}return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},46:function(t,e,n){"use strict";n.d(e,"c",(function(){return S})),n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return w}));var r=n(7),c=n.n(r),a=n(34),o=n.n(a),i=n(9),u=n.n(i),s=n(3),d=n.n(s),p=n(81),f=n.n(p),l=n(20),b=n(117),O=n.n(b),y=n(118),h=n.n(y),v=["addr","content"],E=["avatar"];function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function S(t){return j.apply(this,arguments)}function j(){return(j=u()(d.a.mark((function t(e){var n,r,c,a,i,u,s,p,b;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.addr){t.next=2;break}return t.abrupt("return");case 2:return n=e.addr,r=e.content,c=o()(e,v),i=(a=r||{}).avatar,u=o()(a,E),"base64"===(null===i||void 0===i?void 0:i.type)&&(i.data&&"string"===typeof i.data?(s=i.data,p=h()(s),s=s.slice(s.indexOf(",")+1),s=O()(s,p),i.data=s,i.type="blob"):(i.data=null,i.type=null)),b=g(g({},c),{},{addr:n,content:g(g({},u),{},{avatar:i}),version:e.version||f()(r||Math.random().toString()),expiresAt:Date.now()+6048e5}),t.abrupt("return",l.a.contacts.put(b));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(t){return T.apply(this,arguments)}function T(){return(T=u()(d.a.mark((function t(e){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",l.a.contacts.get(e).catch((function(t){return console.error("D-CHAT: getContact error:",t)})));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t){return _.apply(this,arguments)}function _(){return(_=u()(d.a.mark((function t(e){var n,r,c,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(e);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0={};case 5:return c=t.t0,t.next=8,I(null===c||void 0===c||null===(n=c.content)||void 0===n||null===(r=n.avatar)||void 0===r?void 0:r.data);case 8:if(t.t1=t.sent,t.t1){t.next=11;break}t.t1="";case 11:return a=t.t1,t.abrupt("return",g(g({},c),{},{content:g(g({},c.content),{},{avatar:{type:"base64",data:a}})}));case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function I(t){return t?new Promise((function(e,n){var r=new FileReader;r.onload=function(){e(r.result)},r.onerror=n,r.readAsDataURL(t)})):""}},55:function(t,e,n){"use strict";n.d(e,"b",(function(){return d})),n.d(e,"f",(function(){return p})),n.d(e,"c",(function(){return f})),n.d(e,"a",(function(){return l})),n.d(e,"e",(function(){return b})),n.d(e,"d",(function(){return O}));var r=n(7),c=n.n(r),a=n(34),o=n.n(a),i=["content","recipient","targetID","topic","value"];function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d=function(t){return{type:"nkn/CREATE_NEW_CLIENT",payload:{client:t}}},p=function(t,e){return{type:"nkn/SET_BALANCE",payload:{balance:e.toFixed(8),address:t}}},f=function(){return{type:"nkn/DEACTIVATE_CLIENTS"}},l=function(t){return{type:"nkn/ACTIVATE_CLIENT",payload:{client:t}}},b=function(t){var e=t.content,n=t.recipient,r=t.targetID,c=t.topic,a=t.value,u=o()(t,i);return{type:"nkn/NEW_TRANSACTION_ALIAS",payload:s({content:e,recipient:n,targetID:r,topic:c,value:a*Math.pow(10,-8)},u)}},O=function(t){return{type:"nkn/GET_BALANCE_ALIAS",payload:{address:t}}}},56:function(t,e,n){"use strict";n.d(e,"a",(function(){return f})),n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return b})),n.d(e,"e",(function(){return y})),n.d(e,"d",(function(){return v}));var r=n(7),c=n.n(r),a=n(9),o=n.n(a),i=n(3),u=n.n(i),s=n(20);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){c()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f=25;function l(t){var e=t.topic,n=t.previous,r=void 0===n?{}:n,c=t.extra,a=void 0===c?0:c,o=r.createdAt||s.b;return s.a.messages.where("[topic+createdAt]").between([e,s.c],[e,o],!1,!1).reverse().limit(f+a).sortBy("createdAt").then((function(t){return t.reverse()}))}function b(t){return O.apply(this,arguments)}function O(){return(O=o()(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",s.a.messages.get(j(e)));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(t){return h.apply(this,arguments)}function h(){return(h=o()(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("reaction"!==e.contentType){t.next=4;break}return t.abrupt("return",A(e));case 4:return t.abrupt("return",g(e));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(t,e){return E.apply(this,arguments)}function E(){return(E=o()(u.a.mark((function t(e,n){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(e);case 2:if(!(r=t.sent)){t.next=6;break}return e=p(p({},r),n),t.abrupt("return",s.a.messages.put(e).then((function(){return e})).catch((function(t){return console.error("D-CHAT: HUGE RED FLAG, DB STORAGE",t)})));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function A(t){return s.a.reactions.put(t).catch((function(t){return console.error("D-CHAT: HUGE RED FLAG, DB STORAGE",t)}))}function g(t){return S.apply(this,arguments)}function S(){return(S=o()(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(e);case 2:return(n=t.sent)&&(e.createdAt=n.createdAt),t.abrupt("return",s.a.messages.put(e).then((function(){return e})).catch((function(t){return console.error("D-CHAT: HUGE RED FLAG, DB STORAGE",t)})));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function j(t){return{topic:t.topic,id:t.id,addr:t.addr}}},59:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return c})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o}));var r=function(t,e){return{type:"contacts/RECEIVE_CONTACT_REQUEST",payload:{addr:t,contact:e}}},c=function(t){return{type:"contacts/UPDATE_CONTACT",payload:{contact:t}}},a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"full";return{type:"contacts/REQUEST_CONTACT",payload:{addr:t,requestType:e}}},o=function(t,e){return{type:"contacts/SEND_CONTACT_INFO",payload:{contact:e,addr:t}}}},592:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(20);function c(t){var e=t.topic,n=t.targetID;return r.a.reactions.where({topic:e,targetID:n}).toArray()}},594:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(t){return{type:"settings/TOGGLE_USER_MUTE",payload:{addr:t}}}},646:function(t,e,n){},654:function(t,e,n){"use strict";n.r(e);var r=n(604);Object(r.a)()}}]);